<html>
    <head>
        <title>HTML5 Multiple File Upload With Progress Bar</title>
        <style type="text/css">
        * {
            font-family: Verdana, Helvetica, sans-serif;
            font-size: 8pt;
        }
        div {
            margin-top: 4px;
        }
        .progress {
            width: 200px;
            border: 1px solid #BBB;
            background-color: #FFF;
            padding: 0;
        }
        .progress span {
            display: block;
            width: 0px;
            height: 10px;
            background-color: #DDD;
        }
        #from {
            position: absolute;
            top: 120px;
        }
        </style>
        <script type="text/javascript" src="sendFile.js"></script>
        <script type="text/javascript">

        /** basic Safari 4 multiple upload example
         * @author  Andrea Giammarchi
         * @blog    WebReflection [webreflection.blogspot.com]
         */
        onload = function(){

            function size(bytes){   // simple function to show a friendly size
                var i = 0;
                while(1023 < bytes){
                    bytes /= 1024;
                    ++i;
                };
                return  i ? bytes.toFixed(2) + ["", " Kb", " Mb", " Gb", " Tb"][i] : bytes + " bytes";
            };

            // create elements
            var input = document.body.appendChild(document.createElement("input")),
                sub = document.body.appendChild(document.createElement("div")).appendChild(document.createElement("span")),
                bar = document.body.appendChild(document.createElement("div")).appendChild(document.createElement("span")),
                div = document.body.appendChild(document.createElement("div"));
            
            // set input type as file
            input.setAttribute("type", "file");
            
            // enable multiple selection (note: it does not work with direct input.multiple = true assignment)
            input.setAttribute("multiple", "true");
            
            // auto upload on files change
            input.addEventListener("change", function(){
                
                // disable the input
                input.setAttribute("disabled", "true");
                
                sendMultipleFiles({
                
                    // list of files to upload
                    files:input.files,
                    
                    // clear the container 
                    onloadstart:function(){
                        div.innerHTML = "Init upload ... ";
                        sub.style.width = bar.style.width = "0px";
                    },
                    
                    // do something during upload ...
                    onprogress:function(rpe){
                        div.innerHTML = [
                            "Uploading: " + this.file.fileName,
                            "Sent: " + size(rpe.loaded) + " of " + size(rpe.total),
                            "Total Sent: " + size(this.sent + rpe.loaded) + " of " + size(this.total)
                        ].join("<br />");
                        sub.style.width = ((rpe.loaded * 200 / rpe.total) >> 0) + "px";
                        bar.style.width = (((this.sent + rpe.loaded) * 200 / this.total) >> 0) + "px";
                    },
                    
                    // fired when last file has been uploaded
                    onload:function(rpe, xhr){
                        div.innerHTML += ["",
                            "Server Response: " + xhr.responseText
                        ].join("<br />");
                        sub.style.width = bar.style.width = "200px";
                        
                        // enable the input again
                        input.removeAttribute("disabled");
                    },
                    
                    // if something is wrong ... (from native instance or because of size)
                    onerror:function(){
                        div.innerHTML = "The file " + this.file.fileName + " is too big [" + size(this.file.fileSize) + "]";
                        
                        // enable the input again
                        input.removeAttribute("disabled");
                    }
                });
            }, false);
            
            sub.parentNode.className = bar.parentNode.className = "progress";
        };
        </script>
    </head>
    <body>
        <div id="from">
            <a href="http://webreflection.blogspot.com/2009/03/safari-4-multiple-upload-with-progress.html">by Andrea Giammarchi - WebReflection</a>
        </div>
    </body>
</html>